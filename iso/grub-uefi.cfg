# JSOS GRUB2 EFI configuration — Item 3: UEFI/GPT boot path
#
# This file is placed at /EFI/BOOT/grub.cfg on the EFI System Partition (ESP)
# and is also embedded in the GRUB2 EFI image via --embed flag.
#
# UEFI GRUB can still use the multiboot2 command to load a Multiboot2 kernel;
# however, the EFI map and handoff structures differ from BIOS (no INT 15h /
# E820 — instead MB2 uses the EFI memory map tags 17/19 which memory.c now
# handles). The kernel detects UEFI-vs-BIOS via secboot_is_uefi().

set default=0
set timeout=3
set gfxpayload=keep           # keep whatever EFI GOP mode was active

# Item 3: UEFI boot uses EFI GOP framebuffer — no VBE
# gfxpayload=keep preserves the EFI GOP FB set by firmware before GRUB started.

menuentry "JSOS (UEFI)" {
    insmod part_gpt
    insmod fat
    insmod multiboot2
    multiboot2 /boot/jsos.bin
    boot
}

menuentry "JSOS (UEFI selftest)" {
    insmod part_gpt
    insmod fat
    insmod multiboot2
    multiboot2 /boot/jsos.bin --selftest
    boot
}

menuentry "JSOS (UEFI verbose debug)" {
    insmod part_gpt
    insmod fat
    insmod multiboot2
    multiboot2 /boot/jsos.bin --log=debug
    boot
}

menuentry "JSOS (UEFI safe mode)" {
    insmod part_gpt
    insmod fat
    insmod multiboot2
    multiboot2 /boot/jsos.bin --no-jit --log=verbose
    boot
}
